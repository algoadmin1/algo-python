// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © algoinvestorr

//@version=5
indicator("barPivots", overlay=true)

// Get the high of the previous bar
piv = ( high[1] + close[1] + low[1] ) /3

// get pivot from yesterday, yesterday-1 and yesterday-2
p2d = ( high[2] + close[2] + low[2] ) /3
p3d = ( high[3] + close[3] + low[3] ) /3
p4d = ( high[4] + close[4] + low[4] ) /3
p3 = ( p2d + p3d + p4d )/ 3

// line width
lw0 = 3

//  TESTING

int jb_bar       = bar_index
int jb_barlast   = 0
int jb_barThresh = 3
int jb_barcnt_Buy  = 0
int jb_barcnt_Sell = 0
int jb_sellSigCnt =0
int jb_buySigCnt  =0



string baridx_str = "Hello World!" 

// string baridx_str1 = bar_index.tostring()
string txtstr = " " + str.tostring( bar_index ,format.mintick )

string txtstrSell = "SELL" + txtstr
string txtstrBuy  = "BUY" + txtstr

//  OPERATIONAL

isCrossUnderSell2 = 0
isCrossUnderSell = if(ta.crossunder(piv, p3) )
    1
else
    0

isCrossUnderBuy2 = 0
isCrossUnderBuy  = if(ta.crossunder(p3, piv) )
    1
else
    0

if isCrossUnderSell==1
    jb_sellSigCnt := jb_sellSigCnt +1
    // diff0 = bar_index - jb_barlast
    // if jb_barcnt_Sell > jb_barThresh
    //     isCrossUnderSell2 := 1
    //     jb_barlast := bar_index




//    plotshape( isCrossOverBuy, style = shape.arrowup, color = color.red, size = size.large )
// plotshape( isCrossUnderSell, style = shape.arrowdown, color = color.red,  size = size.large )
// plotshape( isCrossUnderBuy,  style = shape.arrowup,  color = color.green, size = size.large )

if isCrossUnderSell ==1
    label.new(x=bar_index, y=high+10, text=txtstrSell, style=label.style_label_down, color=color.red)
    //label.new(x=bar_index, y=high, text="SELL" + tostring(bar_index), style=label.style_label_down, color=color.red)

if isCrossUnderBuy==1
    label.new(x=bar_index, y=low-10, text=txtstrBuy , style=label.style_label_up, color=color.green)

    //plotshape(isEqual101, style=shape.triangleup, locati on=location.abovebar, color=color.green, size=size.small)


// Plotting the pivot value
plot(piv, color=color.blue, linewidth=lw0)

// Plotting the p3 value
plot(p3, color=color.rgb(243, 229, 33), linewidth=lw0)



